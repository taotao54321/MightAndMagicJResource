<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>マイトアンドマジック (FC) 攻略&#x2F;解析 -エンカウント -戦闘前フェイズ</title>

    <link rel="stylesheet" href="https://taotao54321.github.io/MightAndMagicJResource/css/main.css">
</head>
<body><header><a href="https://taotao54321.github.io/MightAndMagicJResource/">マイトアンドマジック (FC) 攻略&#x2F;解析</a>
            
                - 
            <a href="https://taotao54321.github.io/MightAndMagicJResource/encounter/">エンカウント</a>
            
            </header>

    <h1>戦闘前フェイズ</h1>

    <p>戦闘前フェイズについて。これは<a href="https://taotao54321.github.io/MightAndMagicJResource/encounter/preemptive/">先制判定/処理</a>において戦闘回避も敵先制も起こらなかった場合に実行される。</p>
<p>戦闘前フェイズでは「たたかう」「おくりもの」「にげる」「こうさん」からコマンドを選択する。</p>
<p>「たたかう」またはキャンセルを選んだ場合、単に戦闘に突入する。(<span class="xxx">実はこのとき Wizardry 風の性格変更処理が行われるが、実際には機能していない</span>: <a href="https://taotao54321.github.io/MightAndMagicJResource/tips/unused-alignment-change/">詳細</a>)</p>
<p>「おくりもの」「にげる」「こうさん」については以下で個別に述べる。</p>
<p><span class="note">注意</span>: 本項におけるGOLDの処理は全て <code>u24</code> 演算である。つまり、値の読み書きにおいて最上位バイトは無視される。</p>
<h2 id="bribe">「おくりもの」コマンド</h2>
<p>「GEM」「FOOD」「GOLD」「やめる」からコマンドを選択する。</p>
<p>「やめる」またはキャンセルを選んだ場合、単に戦闘に突入する。</p>
<p>「GEM」「FOOD」「GOLD」については以下で個別に述べる。なお、戦闘を回避できた場合、PTは現在の座標にとどまる。</p>
<h3 id="bribe-gem">「おくりもの」-&gt;「GEM」コマンド</h3>
<p>PT先頭の者のGEMが 0 なら拒絶され、戦闘に突入する。さもなくばPT全員のGEMが 0 になって戦闘を回避できる。</p>
<h3 id="bribe-food">「おくりもの」-&gt;「FOOD」コマンド</h3>
<p>PT先頭の者のFOODが 0 なら拒絶され、戦闘に突入する。さもなくば現在のマップに設定された成功確率に基づく乱数判定を行い、成功したらPT全員のFOODが 0 になって戦闘を回避できる。失敗した場合は拒絶され、戦闘に突入する。</p>
<h3 id="bribe-gold">「おくりもの」-&gt;「GOLD」コマンド</h3>
<p>PT先頭の者のGOLDが 0 なら拒絶される。さもなくば 1/2 の確率で成功し、PT全員のGOLDが 0 になって戦闘を回避できる。失敗した場合は拒絶され、戦闘に突入する。</p>
<h2 id="flee">「にげる」コマンド</h2>
<p>99/110 の確率で成功し、戦闘を回避できる。このときPTは現在のマップの初期座標へ移動する。失敗した場合は戦闘に突入する。</p>
<p><span class="xxx">失敗した場合に追加の成功判定を行うコードがあるが、実際には機能していない。</span>乱数を振り直すのを忘れたものと思われる。</p>
<h2 id="giveup">「こうさん」コマンド</h2>
<p>準備として <code>(敵軍友好度) = (敵軍中でモンスターランクが最大の者(同点の場合は敵インデックスが最大の者)の友好度)</code> と定義する。</p>
<p>降参コマンドの成功判定は 2 段階ある。成功した場合、物資(GOLD/GEM/FOOD)を失う可能性がある。また、第 1 判定と第 2 判定では成功時のPT座標が異なる。</p>
<p>まず <code>1..=100</code> の乱数 <code>r</code> を発生する。</p>
<p>そして第 1 判定を行う。<code>r &gt; (現在のマップの降参失敗率 (%))</code> ならば成功して戦闘を回避でき、PTは現在の座標にとどまり、PT全員のGOLDが 0 になる。</p>
<p>第 1 判定に失敗したら第 2 判定を行う。<code>r &lt; (敵軍友好度)</code> ならば成功して戦闘を回避でき、PTは現在のマップに設定された「降参ワープ先座標」へ移動し、さらに新たな乱数を発生して物資消失判定を行う。各事象とその確率は以下の通り:</p>
<table><thead><tr><th>事象</th><th style="text-align: right">確率</th></tr></thead><tbody>
<tr><td>物資は失われない</td><td style="text-align: right">50/200</td></tr>
<tr><td>PT全員のGOLDが 0 になる</td><td style="text-align: right">100/200</td></tr>
<tr><td>PT全員のGEMが 0 になる</td><td style="text-align: right">10/200</td></tr>
<tr><td>PT全員のFOODが 0 になる</td><td style="text-align: right">10/200</td></tr>
<tr><td>PT全員のGOLD, FOODが 0 になる</td><td style="text-align: right">20/200</td></tr>
<tr><td>PT全員のGOLD, GEMが 0 になる</td><td style="text-align: right">9/200</td></tr>
<tr><td>PT全員のGOLD, GEM, FOODが 0 になる</td><td style="text-align: right">1/200</td></tr>
</tbody></table>
<p>第 2 判定にも失敗したら戦闘に突入する。</p>
</body>
</html>
