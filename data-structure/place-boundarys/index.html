<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>マイトアンドマジック (FC) 攻略&#x2F;解析 -データ構造 -マップ境界配列</title>

    <link rel="stylesheet" href="https://taotao54321.github.io/MightAndMagicJResource/css/main.css">
</head>
<body><header><a href="https://taotao54321.github.io/MightAndMagicJResource/">マイトアンドマジック (FC) 攻略&#x2F;解析</a>
            
                - 
            <a href="https://taotao54321.github.io/MightAndMagicJResource/data-structure/">データ構造</a>
            
            </header>

    <h1>マップ境界配列</h1>

    <p>マップの各マスの周囲 4 方向はただの通路だったり、壁、森、扉などがあったりする。これらを「境界」と総称する。
境界は通行可否とは別の概念である(見た目が壁でも通行可能だったり、逆に見た目が通路でも通行不可なケースなどがある)。</p>
<p>マップの各マスは周囲 4 方向について境界の値 (<code>0..=3</code>) を持っている。
値 <code>0</code> は通路を意味し、値 <code>1..=3</code> の意味はマップごとに異なる。</p>
<p>境界の値は 2bit なので、1 マスの周囲 4 方向の境界は 1 バイトに pack できる。この pack されたバイトを <code>16 * 16 = 256</code> 個並べた配列を「マップ境界配列」と呼ぶ。</p>
<p>マップ境界配列のバイト内の pack 形式は以下の通り:</p>
<table><thead><tr><th>bit</th><th>意味</th></tr></thead><tbody>
<tr><td>6-7</td><td>北の境界</td></tr>
<tr><td>4-5</td><td>東の境界</td></tr>
<tr><td>2-3</td><td>南の境界</td></tr>
<tr><td>0-1</td><td>西の境界</td></tr>
</tbody></table>
<p>マップ境界配列の並び順は row-major で、y, x ともに昇順。つまり座標 (0, 0), (1, 0), ..., (15, 0), (1, 0), ... のように並んでいる。たとえばオフセット 19 は座標 (3, 1) に対応する。</p>
<p>マップ境界配列は <code>$6200-$62FF</code> にロードされる。イベントにより動的に書き換わる場合もある。</p>
</body>
</html>
