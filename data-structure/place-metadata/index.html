<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>マイトアンドマジック (FC) 攻略&#x2F;解析 -データ構造 -マップメタデータ構造体</title>

    <link rel="stylesheet" href="https://taotao54321.github.io/MightAndMagicJResource/css/main.css">
</head>
<body><header><a href="https://taotao54321.github.io/MightAndMagicJResource/">マイトアンドマジック (FC) 攻略&#x2F;解析</a>
            
                - 
            <a href="https://taotao54321.github.io/MightAndMagicJResource/data-structure/">データ構造</a>
            
            </header>

    <h1>マップメタデータ構造体</h1>

    <p>マップメタデータ構造体は 0x4E バイトで、<a href="https://taotao54321.github.io/MightAndMagicJResource/prg/prg-28/">PRG 28</a> 内に格納されている。</p>
<p>ゲーム中は現在のマップのメタデータからマップ名を除いた部分が <code>$6180-$61BF</code> にロードされる。これはイベントにより動的に書き換わる場合もある。</p>
<p>マップメタデータ構造体の内容は以下の通り:</p>
<table><thead><tr><th>offset</th><th>型</th><th>内容</th></tr></thead><tbody>
<tr><td>0x00</td><td><code>u8[14]</code></td><td>マップ名 (0xFF 終端)</td></tr>
<tr><td>0x0E</td><td><code>u8</code></td><td>僧ML4「浮上」が成功した際のテレポート先マップID</td></tr>
<tr><td>0x0F</td><td><code>u8</code></td><td>エンカウント時の敵軍先制率 (%) + 1</td></tr>
<tr><td>0x10</td><td><code>u8</code></td><td>エンカウント時の自軍先制率 (%) + 1</td></tr>
<tr><td>0x11</td><td><code>u8</code></td><td>戦闘前フェイズの「にげる」失敗時に追加の成功判定を行う確率<br><span class="xxx">実質未使用</span>: <a href="https://taotao54321.github.io/MightAndMagicJResource/encounter/pre-battle/#flee">詳細</a></td></tr>
<tr><td>0x12</td><td><code>u8</code></td><td>初期座標x</td></tr>
<tr><td>0x13</td><td><code>u8</code></td><td>初期座標y</td></tr>
<tr><td>0x14</td><td><code>u8</code></td><td>戦闘前フェイズの「こうさん」第 1 判定失敗率 (%) + 1</td></tr>
<tr><td>0x15</td><td><code>u8</code></td><td>降参ワープ先座標x</td></tr>
<tr><td>0x16</td><td><code>u8</code></td><td>降参ワープ先座標y</td></tr>
<tr><td>0x17</td><td><code>u8</code></td><td>戦闘前フェイズの「おくりもの」-&gt;「FOOD」成功率 (%) + 1</td></tr>
<tr><td>0x18</td><td><code>u8</code></td><td>休息を試みた際の夜襲発生率の分母 (分子は 1)<br>0 の場合は夜襲が発生しない(が、そのようなマップはない)</td></tr>
<tr><td>0x19</td><td><code>u8</code></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x1A</td><td><code>u8</code></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x1B</td><td><code>u8</code></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x1C</td><td><code>u8[3]</code></td><td>境界の値 <code>1..=3</code> それぞれの種類 (0:壁, 1:扉, 2:森/沼, 3:山, 4:海, 5:砂漠)<br>(見た目には影響しない)</td></tr>
<tr><td>0x1F</td><td><code>u8</code></td><td>徘徊エンカウント発生率の分母 (分子は 1)<br>0 の場合は徘徊エンカウントが発生しない (アストラル世界のみ該当)</td></tr>
<tr><td>0x20</td><td><code>u8</code></td><td>ランダム敵のモンスターランク上限</td></tr>
<tr><td>0x21</td><td><code>u8</code></td><td>ランダム敵のモンスターランク下限</td></tr>
<tr><td>0x22</td><td><code>u8</code></td><td>エンカウント時の敵の個体数の最大値</td></tr>
<tr><td>0x23</td><td><code>u8</code></td><td>バーン内エリア列 (文字 <code>'A'..='E'</code> がそのまま入っている)</td></tr>
<tr><td>0x24</td><td><code>u8</code></td><td>バーン内エリア行 (文字 <code>'1'..='4'</code> がそのまま入っている)</td></tr>
<tr><td>0x25</td><td><code>u8</code></td><td>マップ種別 (0:地上, 0xFD:城, 0xFE:町, 0xFF:未知の世界, 1..:ダンジョン地下n階)</td></tr>
<tr><td>0x26</td><td><code>u8</code></td><td>バーンエリア内座標x</td></tr>
<tr><td>0x27</td><td><code>u8</code></td><td>バーンエリア内座標y</td></tr>
<tr><td>0x28</td><td><code>u8</code></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x29</td><td><code>u8[4]</code></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x2D</td><td></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x2E</td><td><code>u8[4*4]</code></td><td>BGパレット</td></tr>
<tr><td>0x3E</td><td><code>u8[4*2]</code></td><td>スプライトパレット 0, 1</td></tr>
<tr><td>0x46</td><td></td><td><span class="todo">TODO</span></td></tr>
<tr><td></td><td></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x4A</td><td><code>u8</code></td><td>マップデータ (0x200 バイト) を格納している PRG バンクID</td></tr>
<tr><td>0x4B</td><td><code>u8</code></td><td>マップデータ (0x200 バイト) のバンク内インデックス</td></tr>
<tr><td>0x4C</td><td></td><td><span class="todo">TODO</span></td></tr>
<tr><td>0x4D</td><td></td><td><span class="todo">TODO</span></td></tr>
</tbody></table>
</body>
</html>
