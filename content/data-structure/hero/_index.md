+++
title = "味方キャラ構造体"
+++

## 概要

味方キャラ構造体は 0x70 バイトで、アドレス `$6F00` から 0x80 バイトアラインメントで味方キャラID順に配置されている:

* 味方キャラID 0: `$6F00-$6F6F`
* 味方キャラID 1: `$6F80-$6FEF`
* ...
* 味方キャラID 15: `$7680-$76EF`

多くの場合、これらの味方キャラ構造体は直接操作されるのではなく、バッファ `$0A-$79` にコピーしたものが操作され、その結果がまとめて書き戻されている。

味方キャラ構造体の一部のフィールドは主人公 (味方キャラID 0) 専用で、これらのフィールドについては前述のバッファにコピーされる際に主人公のもので上書きされ、バッファから書き戻される際も主人公の構造体にコピーされる。

味方キャラ構造体の内容は以下の通り:

| offset | 型 | 内容 |
| -- | -- | -- |
| 0x00 | `u8` | 性別 (1:男, 2:女) |
| 0x01 | `u8` | 性格 (永続) (1:善, 2:悪, 3:中立) |
| 0x02 | `u8` | 性格 (一時的) (1:善, 2:悪, 3:中立) |
| 0x03 | `u8` | 種族 (1:人間, 2:エルフ, 3:ドワーフ, 4:ノーム, 5:半オーク) |
| 0x04 | `u8` | 職業 (1:騎士, 2:戦士, 3:弓使い, 4:僧侶, 5:魔法使い, 6:盗賊) |
| 0x05 | `u8` | 知性 (永続) |
| 0x06 | `u8` | 知性 (一時的) |
| 0x07 | `u8` | 力 (永続) |
| 0x08 | `u8` | 力 (一時的) |
| 0x09 | `u8` | 魅力 (永続) |
| 0x0A | `u8` | 魅力 (一時的) |
| 0x0B | `u8` | 耐久 (永続) |
| 0x0C | `u8` | 耐久 (一時的) |
| 0x0D | `u8` | 素早さ (永続) |
| 0x0E | `u8` | 素早さ (一時的) |
| 0x0F | `u8` | 技能 (永続) |
| 0x10 | `u8` | 技能 (一時的) |
| 0x11 | `u8` | 幸運 (永続) |
| 0x12 | `u8` | 幸運 (一時的) |
| 0x13 | `u8` | レベル (永続) |
| 0x14 | `u8` | レベル (一時的) |
| 0x15 | `u8` | 年齢 |
| 0x16 | `u8` | 休息した回数 (値が 100 のとき休息すると 1 歳加齢し、値が 0 に戻る) |
| 0x17 | `u32le` | 経験値 ({% note() %}注意{% end %}: しばしば `u24` として扱われる(最上位バイトが無視される)) |
| 0x1B | `u16le` | 現在MP |
| 0x1D | `u16le` | 最大MP |
| 0x1F | `u8` | 魔法レベル (永続) |
| 0x20 | `u8` | 魔法レベル (一時的) |
| 0x21 | `u16le` | GEM |
| 0x23 | `u16le` | 現在HP |
| 0x25 | `u16le` | 最大HP (永続) |
| 0x27 | `u16le` | 最大HP (一時的) |
| 0x29 | `u32le` | GOLD ({% note() %}注意{% end %}: しばしば `u24` として扱われる(最上位バイトが無視される)) |
| 0x2D | `u8` | AC (補正前) |
| 0x2E | `u8` | AC (補正後) |
| 0x2F | `u8` | FOOD |
| 0x30 | `u8` | 状態異常 |
| 0x31 | `u8[6]` | 装備品の[アイテムID](@/item/_index.md#table)配列 |
| 0x37 | `u8[6]` | バックパックの[アイテムID](@/item/_index.md#table)配列 |
| 0x3D | `u8[6]` | 装備品の残りチャージ数配列 |
| 0x43 | `u8[6]` | バックパックの残りチャージ数配列 |
| 0x49 | `u8` | 魔法耐性 (永続) |
| 0x4A | `u8` | 魔法耐性 (一時的) |
| 0x4B | `u8` | 火耐性 (永続) |
| 0x4C | `u8` | 火耐性 (一時的) |
| 0x4D | `u8` | 冷気耐性 (永続) |
| 0x4E | `u8` | 冷気耐性 (一時的) |
| 0x4F | `u8` | 電撃耐性 (永続) |
| 0x50 | `u8` | 電撃耐性 (一時的) |
| 0x51 | `u8` | 酸耐性 (永続) |
| 0x52 | `u8` | 酸耐性 (一時的) |
| 0x53 | `u8` | 恐怖耐性 (永続) |
| 0x54 | `u8` | 恐怖耐性 (一時的) |
| 0x55 | `u8` | 毒耐性 (永続) |
| 0x56 | `u8` | 毒耐性 (一時的) |
| 0x57 | `u8` | 眠り耐性 (永続) |
| 0x58 | `u8` | 眠り耐性 (一時的) |
| 0x59 | `u8` | 近接武器ダメージダイス面数 |
| 0x5A | `u8` | 近接武器ダメージダイス追加値 |
| 0x5B | `u8` | 射撃武器ダメージダイス面数 |
| 0x5C | `u8` | 射撃武器ダメージダイス追加値 |
| 0x5D | `u8` | 解錠スキル |
| 0x5E | `u8` | **主人公専用**: [請けている諸侯クエスト](#king_quest) |
| 0x5F | `u8` | **主人公専用**: [囚人解放クエスト報酬決定用の値](#prisoner-quest-reward-value) |
| 0x60 | `u8` | 粒度を細かくした性格 (0:完全な善, 16:完全な中立, 32:完全な悪)<br>{% xxx() %}実質未使用{% end %} |
| 0x61 | `u8` | **主人公専用**: [メインクエスト関連フラグ (序中盤)](#mainstory-midgame) |
| 0x62 | `u8` | **主人公専用**: [囚人解放クエスト関連フラグ](#prisoner-quest) |
| 0x63 | `u8` | **主人公専用**: [ビースト討伐クエスト関連フラグ](#beast-quest) |
| 0x64 | `u8` | **主人公専用**: (未使用) |
| 0x65 | `u8` | [オーラの色など](#aura-etc) |
| 0x66 | `u8` | **主人公専用**: [インスペクトロン王のクエストの達成状況](#inspectron-achieved) |
| 0x67 | `u8` | **主人公専用**: [ハッカー王のクエストの達成状況](#hacker-achieved) |
| 0x68 | `u8` | **主人公専用**: [アイアンフィスト王のクエストの達成状況](#ironfist-achieved) |
| 0x69 | `u8` | **主人公専用**: [インスペクトロン王のクエストの報酬受け取り状況](#inspectron-rewarded) |
| 0x6A | `u8` | **主人公専用**: [ハッカー王のクエストの報酬受け取り状況](#hacker-rewarded) |
| 0x6B | `u8` | **主人公専用**: [アイアンフィスト王のクエストの報酬受け取り状況](#ironfist-rewarded) |
| 0x6C | `u8` | [各地の能力値上昇ポイントの使用状況](#gained-stats) |
| 0x6D | `u8` | **主人公専用**: [メインクエスト関連フラグ (終盤)](#mainstory-endgame) |
| 0x6E | `u8` | 常に 0 |
| 0x6F | `u8` | 滞在している[マップID](@/map/_index.md) |


## フィールドの詳細

### offset=0x5E: **主人公専用**: 請けている諸侯クエスト {#king_quest}

| 値 | 意味 |
| -- | -- |
|  0 | (諸侯クエストを請けていない) |
|  1 | アイアンフィスト王 1: レイバンの森の要塞を探せ |
|  2 | アイアンフィスト王 2: 行方不明のキルバーン王を探せ |
|  3 | アイアンフィスト王 3: ポートスミスの秘密を暴け |
|  4 | アイアンフィスト王 4: 海賊の秘密の洞窟を探せ |
|  5 | アイアンフィスト王 5: 行方不明の探検家ジョリー・レイバンを探せ |
|  6 | アイアンフィスト王 6: 幽霊海賊船アナーキストを滅ぼせ |
|  7 | アイアンフィスト王 7: レイバンの森の要塞を征服せよ |
|  8 | インスペクトロン王 1: クイバリングの森にある廃墟を探せ |
|  9 | インスペクトロン王 2: ブリセス・ピークに登れ |
| 10 | インスペクトロン王 3: 砂漠の住人たちが取引している品物を手に入れよ |
| 11 | インスペクトロン王 4: ダスクの下の洞窟でオクザールの神殿を探せ |
| 12 | インスペクトロン王 5: ドラガデューンのGOLDを経験に変える泉を探せ |
| 13 | インスペクトロン王 6: レイバンの要塞でクリスタルの謎を解け |
| 14 | インスペクトロン王 7: 魔法の森の要塞を征服せよ |
| 15 | ハッカー王: 1: にんにくを持ってこい |
| 16 | ハッカー王: 2: とりかぶとを持ってこい |
| 17 | ハッカー王: 3: ベラドンナを持ってこい |
| 18 | ハッカー王: 4: メデューサの首を持ってこい |
| 19 | ハッカー王: 5: ウィバーンの目を持ってこい |
| 20 | ハッカー王: 6: ドラゴンの歯を持ってこい |
| 21 | ハッカー王: 7: オクリムの指輪を持ってこい |
| 0xFF | 偽アラマー王: カーメンカのクリプトを探せ (**達成不可能**) |

### offset=0x5F: **主人公専用**: 囚人解放クエスト報酬決定用の値 {#prisoner-quest-reward-value}

{% todo() %}TODO{% end %}

### offset=0x61: **主人公専用**: メインクエスト関連フラグ (序中盤) {#mainstory-midgame}

| bit | 意味 |
| -- | -- |
| 0 | コーラックからアガールへの手紙配達依頼を遂行中 |
| 1 | アガールからテルゴランへの手紙配達依頼を遂行中 |
| 2 | テルゴランからザム/ゾム捜索依頼を請けた |
| 3 | ゾムからルビーの笛に関するヒントを聞いた |
| 4 | ザムからルビーの笛に関するヒントを聞いた |
| 5 | ルビーの笛を入手した |
| 6 | 魔法の砦に入った |
| 7 | 黒白ぶちの犬の青像からキルバーン王の情報を聞いた |

### offset=0x62: **主人公専用**: 囚人解放クエスト関連フラグ {#prisoner-quest}

{% note() %}囚人に会ったフラグは選択肢 (助ける/拷問/立ち去る) によらず立つ{% end %}ので、実際には必ずしも囚人を解放する必要はない。

| bit | 意味 |
| -- | -- |
| 0 | ラナローから囚人解放クエストを請けた |
| 1 | ドラガデューンの城の囚人(床に繋がれた生き物)に会った |
| 2 | デュームの城の囚人(小さな子供)に会った |
| 3 | アラマーの城の囚人(美しい少女)に会った |
| 4 | ホワイトウルフの城の囚人(デモン)に会った |
| 5 | ブラックリッジノースの囚人(足枷をかけられた男)に会った |
| 6 | ブラックリッジサウスの囚人(奇妙なコートを着たモンスター)に会った |
| 7 | 審判のジャイアントの秤に乗った (*write-only*) |

### offset=0x63: **主人公専用**: ビースト討伐クエスト関連フラグ {#beast-quest}

{% note() %}各ビーストについてはエンカウントしただけでフラグが立つ。{% end %}倒さずに逃げたりしてもよい。

| bit | 意味 |
| -- | -- |
| 0 | 海のビーストとエンカウントした |
| 1 | 砂漠のビーストとエンカウントした |
| 2 | 空のビーストとエンカウントした |
| 3 | 森のビーストとエンカウントした |
| 4-6 | (未使用) |
| 7 | 幸運の車輪に訪れた(回したかどうかは問わない) (*write-only*) |


### offset=0x65: オーラの色など {#aura-etc}

| bit | 意味 |
| -- | -- |
| 0-3 | オーラの色 (0:未決定, 1:赤, 2:青, 3:緑, 4:黄, 5:紫, 6:オレンジ, 7:黒, 8:白, 15:金) |
| 4-5 | (未使用) |
| 6 | バーン地上E2のロボットと会話した(会話時にPT先頭の者についてのみフラグが立つ) |
| 7 | バーン地上A4の老人に自身のオーラの色を正しく答えた (*write-only*) |

### offset=0x66: **主人公専用**: インスペクトロン王のクエストの達成状況 {#inspectron-achieved}

クエストを請ける前でも達成フラグは立つ。また、報酬を受け取ったかどうかは無関係。

| bit | 意味 |
| -- | -- |
| 0 | クエスト 1 を達成済み (クイバリングの森にある廃墟を探せ) |
| 1 | クエスト 2 を達成済み (ブリセス・ピークに登れ) |
| 2 | クエスト 3 を達成済み (砂漠の住人たちが取引している品物を手に入れよ) |
| 3 | クエスト 4 を達成済み (ダスクの下の洞窟でオクザールの神殿を探せ) |
| 4 | クエスト 5 を達成済み (ドラガデューンのGOLDを経験に変える泉を探せ) |
| 5 | クエスト 6 を達成済み (レイバンの要塞でクリスタルの謎を解け) |
| 6 | クエスト 7 を達成済み (魔法の森の要塞を征服せよ) |
| 7 | 全 7 クエストの報酬を受け取った後、さらにクエストを受注しようとすると 1 になる (*write-only*) |

### offset=0x67: **主人公専用**: ハッカー王のクエストの達成状況 {#hacker-achieved}

クエストを請ける前でも達成フラグは立つ。また、報酬を受け取ったかどうかは無関係。

| bit | 意味 |
| -- | -- |
| 0 | クエスト 1 を達成済み (にんにくを持ってこい) |
| 1 | クエスト 2 を達成済み (とりかぶとを持ってこい) |
| 2 | クエスト 3 を達成済み (ベラドンナを持ってこい) |
| 3 | クエスト 4 を達成済み (メデューサの首を持ってこい) |
| 4 | クエスト 5 を達成済み (ウィバーンの目を持ってこい) |
| 5 | クエスト 6 を達成済み (ドラゴンの歯を持ってこい) |
| 6 | クエスト 7 を達成済み (オクリムの指輪を持ってこい) |
| 7 | 全 7 クエストの報酬を受け取った後、さらにクエストを受注しようとすると 1 になる (*write-only*) |

### offset=0x68: **主人公専用**: アイアンフィスト王のクエストの達成状況 {#ironfist-achieved}

クエストを請ける前でも達成フラグは立つ。また、報酬を受け取ったかどうかは無関係。

| bit | 意味 |
| -- | -- |
| 0 | クエスト 1 を達成済み (レイバンの森の要塞を探せ) |
| 1 | クエスト 2 を達成済み (行方不明の王ロード・キルバーンを探せ) |
| 2 | クエスト 3 を達成済み (ポートスミスの秘密を暴け) |
| 3 | クエスト 4 を達成済み (海賊の秘密の洞窟を探せ) |
| 4 | クエスト 5 を達成済み (行方不明の探検家ジョリー・レイバンを探せ) |
| 5 | クエスト 6 を達成済み (幽霊海賊船アナーキストを滅ぼせ) |
| 6 | クエスト 7 を達成済み (レイバンの森の要塞を征服せよ) |
| 7 | 全 7 クエストの報酬を受け取った後、さらにクエストを受注しようとすると 1 になる (*write-only*) |

### offset=0x69: **主人公専用**: インスペクトロン王のクエストの報酬受け取り状況 {#inspectron-rewarded}

| bit | 意味 |
| -- | -- |
| 0 | クエスト 1 の報酬を受け取り済み (クイバリングの森にある廃墟を探せ) |
| 1 | クエスト 2 の報酬を受け取り済み (ブリセス・ピークに登れ) |
| 2 | クエスト 3 の報酬を受け取り済み (砂漠の住人たちが取引している品物を手に入れよ) |
| 3 | クエスト 4 の報酬を受け取り済み (ダスクの下の洞窟でオクザールの神殿を探せ) |
| 4 | クエスト 5 の報酬を受け取り済み (ドラガデューンのGOLDを経験に変える泉を探せ) |
| 5 | クエスト 6 の報酬を受け取り済み (レイバンの要塞でクリスタルの謎を解け) |
| 6 | クエスト 7 の報酬を受け取り済み (魔法の森の要塞を征服せよ) |
| 7 | 全 7 クエストの報酬を受け取った後、さらにクエストを受注しようとすると 1 になる (*write-only*) |

### offset=0x6A: **主人公専用**: ハッカー王のクエストの報酬受け取り状況 {#hacker-rewarded}

| bit | 意味 |
| -- | -- |
| 0 | クエスト 1 の報酬を受け取り済み (にんにくを持ってこい) |
| 1 | クエスト 2 の報酬を受け取り済み (とりかぶとを持ってこい) |
| 2 | クエスト 3 の報酬を受け取り済み (ベラドンナを持ってこい) |
| 3 | クエスト 4 の報酬を受け取り済み (メデューサの首を持ってこい) |
| 4 | クエスト 5 の報酬を受け取り済み (ウィバーンの目を持ってこい) |
| 5 | クエスト 6 の報酬を受け取り済み (ドラゴンの歯を持ってこい) |
| 6 | クエスト 7 の報酬を受け取り済み (オクリムの指輪を持ってこい) |
| 7 | 全 7 クエストの報酬を受け取った後、さらにクエストを受注しようとすると 1 になる (*write-only*) |

### offset=0x6B: **主人公専用**: アイアンフィスト王のクエストの報酬受け取り状況 {#ironfist-rewarded}

| bit | 意味 |
| -- | -- |
| 0 | クエスト 1 の報酬を受け取り済み (レイバンの森の要塞を探せ) |
| 1 | クエスト 2 の報酬を受け取り済み (行方不明の王ロード・キルバーンを探せ) |
| 2 | クエスト 3 の報酬を受け取り済み (ポートスミスの秘密を暴け) |
| 3 | クエスト 4 の報酬を受け取り済み (海賊の秘密の洞窟を探せ) |
| 4 | クエスト 5 の報酬を受け取り済み (行方不明の探検家ジョリー・レイバンを探せ) |
| 5 | クエスト 6 の報酬を受け取り済み (幽霊海賊船アナーキストを滅ぼせ) |
| 6 | クエスト 7 の報酬を受け取り済み (レイバンの森の要塞を征服せよ) |
| 7 | 全 7 クエストの報酬を受け取った後、さらにクエストを受注しようとすると 1 になる (*write-only*) |

### offset=0x6C: 各地の能力値上昇ポイントの使用状況 {#gained-stats}

キャラごとに管理されている。

| bit | 意味 |
| -- | -- |
| 0 | 耐久 +4 の泉を使用済み ([バーン地上A1 (12, 1)](@/map/map-15/_index.md#event-12-1)) |
| 1 | 魅力 +4 の泉を使用済み ([バーン地上D2 (10, 12)](@/map/map-28/_index.md#event-10-12)) |
| 2 | 知性 +4 の装置を使用済み ([バーン地上E2 (3, 13)](@/map/map-32/_index.md#event-3-13)) |
| 3 | 力 +4 の泉を使用済み ([ポートスミスの地下 (0, 12)](@/map/map-08/_index.md#event-0-12)) |
| 4 | 技能 +4 のプリズムを使用済み ([ダスクの地下 (15, 15)](@/map/map-10/_index.md#event-15-15)) |
| 5 | 素早さ +4 の炎を使用済み ([ダスクの地下 (14, 5)](@/map/map-10/_index.md#event-14-5)) |
| 6 | 幸運 +4 のクローバーを使用済み ([ドラガデューンの城 (1, 1)](@/map/map-40/_index.md#event-1-1)) |
| 7 | [南のクレリック](@/map/map-43/_index.md#event-12-0)に能力値上昇ポイント使用権を復活させてもらうと 1 になる (*write-only*) |

### offset=0x6D: **主人公専用**: メインクエスト関連フラグ (終盤) {#mainstory-endgame}

| bit | 意味 |
| -- | -- |
| 0 | アストラル世界 第1の封印解除済み |
| 1 | アストラル世界 第2の封印解除済み |
| 2 | アストラル世界 第3の封印解除済み |
| 3 | アストラル世界 第4の封印解除済み |
| 4 | アストラル世界 第5の封印解除済み |
| 5 | (未使用) |
| 6 | イドの迷宮クリア済み |
| 7 | [世界の果て](@/map/map-19/_index.md#event-4-15)からエンディングに行ける |
