+++
title = "アイテムデータ構造体"
+++

アイテムデータ構造体は 11 バイトで、[PRG 14](@/prg/prg-14/_index.md) 内に格納されている。

アイテムデータ構造体は ROM 内から直接参照されるのではなく、現在見ているアイテムのデータをバッファ `$02A8-$02B2` にコピーしたものが参照される。

アイテムデータ構造体の内容は以下の通り:

| offset | 型 | 内容 |
| -- | -- | -- |
|  0 | `u8`    | [装備条件](#equip-mask) |
|  1 | `u8`    | [装備効果](#equip-effect) |
|  2 | `u8`    | [装備効果](#equip-effect)の引数 |
|  3 | `u8`    | [使用効果](#use-effect) |
|  4 | `u8`    | [使用効果](#use-effect)の引数 |
|  5 | `u8`    | 初期チャージ数 |
|  6 | `u16le` | 買値 |
|  8 | `u8`    | (武器の場合) ダメージダイス面数 |
|  9 | `u8`    | (武器の場合) ダメージダイス追加値<br>(鎧/盾の場合) AC修正 |
| 10 | `u8`    | (未使用: 意図としては最大チャージ数かも) |

## フィールドの詳細

### offset=0: 装備条件 {#equip-mask}

| bit | 意味                                                 |
| --  | --                                                   |
| 0   | 盗賊は不可                                           |
| 1   | 魔法使いは不可                                       |
| 2   | 僧侶は不可                                           |
| 3   | 弓使いは不可                                         |
| 4   | 戦士は不可                                           |
| 5   | 騎士は不可                                           |
| 6-7 | 0:性格制限なし, 1:善のみ可, 2:悪のみ可, 3:中立のみ可 |

### offset=1: 装備効果 {#equip-effect}

能力修正系の効果については引数の値が加算される。

| 値   | 意味           |
| --   | --             |
| 0x00 | (装備効果なし) |
| 0x01 | (装備不可)     |
| 0x10 | 性別修正       |
| 0x13 | 種族修正       |
| 0x15 | 知性修正       |
| 0x17 | 力修正         |
| 0x19 | 魅力修正       |
| 0x1D | 素早さ修正     |
| 0x1F | 技能修正       |
| 0x21 | 幸運修正       |
| 0x25 | 年齢修正       |
| 0x3C | AC修正         |
| 0x58 | 魔法耐性修正   |
| 0x5A | 火耐性修正     |
| 0x5C | 冷気耐性修正   |
| 0x5E | 電撃耐性修正   |
| 0x60 | 酸耐性修正     |
| 0x62 | 恐怖耐性修正   |
| 0x64 | 毒耐性修正     |
| 0x66 | 眠り耐性修正   |
| 0x6C | 解錠スキル修正 |
| 0xFF | 呪い           |

### offset=3: 使用効果 {#use-effect}

上昇/回復/獲得系の効果については引数の値が加算される。魔法発動の場合、魔法IDは `(引数) + 1` となる。

{% xxx() %}使用効果にはいくつか不具合がある{% end %}: [詳細](@/tips/item-use-effect/_index.md)

| 値   | 意味                                  |
| --   | --                                    |
| 0x00 | (使用効果なし)                        |
| 0x18 | 力一時上昇                            |
| 0x1E | 素早さ一時上昇                        |
| 0x20 | 技能一時上昇                          |
| 0x22 | 幸運一時上昇                          |
| 0x24 | レベル一時上昇                        |
| 0x25 | 年齢上昇                              |
| 0x2B | MP回復                                |
| 0x30 | 魔法レベル一時上昇                    |
| 0x31 | GEM獲得                               |
| 0x3A | GOLDを 256 単位で獲得                 |
| 0x3F | FOOD獲得                              |
| 0x59 | {% xxx() %}永続{% end %} 魔法耐性上昇 |
| 0x63 | {% xxx() %}永続{% end %} 恐怖耐性上昇 |
| 0xFF | 魔法発動                              |
