+++
title = "マップメタデータ構造体"
+++

マップメタデータ構造体は 0x4E バイトで、[PRG 28](@/prg/prg-28/_index.md) 内に格納されている。

ゲーム中は現在のマップのメタデータからマップ名を除いた部分が `$6180-$61BF` にロードされる。これはイベントにより動的に書き換わる場合もある。

マップメタデータ構造体の内容は以下の通り:

| offset | 型 | 内容 |
| -- | -- | -- |
| 0x00 | `u8[14]` | マップ名 (0xFF 終端) |
| 0x0E | `u8` | 僧ML4「浮上」が成功した際のテレポート先マップID |
| 0x0F | `u8` | エンカウント時の敵軍先制率 (%) + 1 |
| 0x10 | `u8` | エンカウント時の自軍先制率 (%) + 1 |
| 0x11 | `u8` | 戦闘前フェイズの「にげる」失敗時に追加の成功判定を行う確率<br>{% xxx() %}実質未使用{% end %} |
| 0x12 | `u8` | 初期座標x |
| 0x13 | `u8` | 初期座標y |
| 0x14 | `u8` | 戦闘前フェイズの「こうさん」第 1 判定失敗率 (%) + 1 |
| 0x15 | `u8` | 降参ワープ先座標x |
| 0x16 | `u8` | 降参ワープ先座標y |
| 0x17 | `u8` | 戦闘前フェイズの「おくりもの」->「FOOD」成功率 (%) + 1 |
| 0x18 | `u8` | 休息を試みた際の夜襲発生率の分母 (分子は 1)<br>0 の場合は夜襲が発生しない(が、そのようなマップはない) |
| 0x19 | `u8` | {% todo() %}TODO{% end %} |
| 0x1A | `u8` | {% todo() %}TODO{% end %} |
| 0x1B | `u8` | {% todo() %}TODO{% end %} |
| 0x1C | `u8[3]` | 境界の値 `1..=3` それぞれの種類 (0:壁, 1:扉, 2:森/沼, 3:山, 4:海, 5:砂漠)<br>(見た目には影響しない)|
| 0x1F | `u8` | 徘徊エンカウント発生率の分母 (分子は 1)<br>0 の場合は徘徊エンカウントが発生しない (アストラル世界のみ該当) |
| 0x20 | `u8` | ランダム敵のモンスターランク上限 |
| 0x21 | `u8` | ランダム敵のモンスターランク下限 |
| 0x22 | `u8` | エンカウント時の敵の個体数の最大値 |
| 0x23 | `u8` | バーン内エリア列 (文字 `'A'..='E'` がそのまま入っている) |
| 0x24 | `u8` | バーン内エリア行 (文字 `'1'..='4'` がそのまま入っている) |
| 0x25 | `u8` | マップ種別 (0:地上, 0xFD:城, 0xFE:町, 0xFF:未知の世界, 1..:ダンジョン地下n階) |
| 0x26 | `u8` | バーンエリア内座標x |
| 0x27 | `u8` | バーンエリア内座標y |
| 0x28 | `u8` | {% todo() %}TODO{% end %} |
| 0x29 | `u8[4]` | {% todo() %}TODO{% end %} |
| 0x2D | | {% todo() %}TODO{% end %} |
| 0x2E | `u8[4*4]` | BGパレット |
| 0x3E | `u8[4*2]` | スプライトパレット 0, 1 |
| 0x46 | | {% todo() %}TODO{% end %} |
| | | {% todo() %}TODO{% end %} |
| 0x4A | `u8` | マップデータ (0x200 バイト) を格納している PRG バンクID |
| 0x4B | `u8` | マップデータ (0x200 バイト) のバンク内インデックス |
| 0x4C | | {% todo() %}TODO{% end %} |
| 0x4D | | {% todo() %}TODO{% end %} |
